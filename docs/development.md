# Our Grocery List - Development Guide

This guide provides instructions for setting up and running the application locally.

## Prerequisites

- **Node.js** 18 or higher
- **.NET 10 SDK**
- **Azure Functions Core Tools** v4 (for running the API locally)

To install Azure Functions Core Tools:
```bash
npm install -g azure-functions-core-tools@4
```

## Project Structure

```
our-grocery-list/
├── frontend/          # React 19 + TypeScript + Tailwind CSS PWA
├── api/              # .NET 10 Azure Functions (isolated worker)
├── package.json      # Root workspace configuration
└── swa-cli.config.json  # Azure Static Web Apps CLI config
```

## Quick Start

### 1. Install Dependencies

From the root directory:

```bash
npm install
```

This will:
- Install root dependencies (SWA CLI)
- Install frontend dependencies (React, Vite, Tailwind, etc.)
- Restore .NET API dependencies

### 2. Start Development Servers

You have two options:

#### Option A: Run Services Separately (Recommended for Development)

**Terminal 1 - Frontend:**
```bash
cd frontend
npm run dev
```
Frontend will be available at `http://localhost:5173`

**Terminal 2 - API:**
```bash
cd api
func start
```
API will be available at `http://localhost:7071`

#### Option B: Use SWA CLI (Experimental)

```bash
npm run dev
```

This attempts to start both frontend and API through the SWA CLI proxy.

## Environment Configuration

### Frontend (.env)

Create `frontend/.env` from `frontend/.env.example`:

```bash
cp frontend/.env.example frontend/.env
```

For local development with separate services, update the API URL:
```
VITE_API_BASE_URL=http://localhost:7071/api
```

For SWA CLI (proxied):
```
VITE_API_BASE_URL=/api
```

### Backend (local.settings.json)

The API already has a `local.settings.json` file. If you need to recreate it, use `api/local.settings.json.example` as a template.

## Available Scripts

From the root directory:

- `npm install` - Install all dependencies
- `npm run dev` - Start both frontend and API with SWA CLI
- `npm run build` - Build both frontend and API
- `npm run build:frontend` - Build frontend only
- `npm run build:api` - Build API only

From the `frontend/` directory:

- `npm run dev` - Start frontend dev server (Vite)
- `npm run build` - Build frontend for production
- `npm run preview` - Preview production build locally
- `npm run lint` - Lint frontend code

## Features

### Frontend
- **React 19** with TypeScript
- **Tailwind CSS** for styling
- **PWA Support** with service worker and manifest
- **Responsive Design** - works on mobile and desktop
- **Offline-First** architecture (via PWA)

### Backend
- **.NET 10** Azure Functions (isolated worker model)
- **In-Memory Storage** using ConcurrentDictionary
- **Pre-seeded Data** with 5 sample grocery items
- **CORS Enabled** for local development
- **camelCase JSON** serialization

### API Endpoints

All endpoints are prefixed with `/api`:

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/items` | Get all grocery items |
| POST | `/api/items` | Create a new item |
| PATCH | `/api/items/{id}` | Update an item (toggle done status) |
| DELETE | `/api/items/{id}` | Delete an item |

## Data Model

### GroceryItem

```typescript
interface GroceryItem {
  id: string;           // GUID
  name: string;         // Required
  notes?: string;       // Optional quantity/notes
  isDone: boolean;      // Completion status
  createdAt: string;    // ISO 8601 timestamp
  updatedAt: string;    // ISO 8601 timestamp
}
```

## Development Notes

### In-Memory Storage

The API uses `ConcurrentDictionary<string, GroceryItem>` for in-memory storage. This means:
- Data persists only while the API is running
- Restarting the API resets data to the pre-seeded state
- No external database is required for local development

### CORS Configuration

The API is configured to accept requests from `http://localhost:5173` (frontend dev server). If you change the frontend port, update `api/Program.cs`:

```csharp
policy.WithOrigins("http://localhost:YOUR_PORT")
```

### PWA Features

The app includes:
- **Manifest** (`frontend/public/manifest.json` - auto-generated by Vite PWA plugin)
- **Service Worker** (auto-generated by Workbox via Vite PWA plugin)
- **App Icons** (placeholder icons at `frontend/public/icon-*.png`)

To test PWA installation:
1. Build the frontend: `cd frontend && npm run build`
2. Serve the build: `npm run preview`
3. Open in Chrome and use "Install App" from the address bar menu

## Troubleshooting

### Frontend not connecting to API

Ensure:
1. API is running on `http://localhost:7071`
2. `frontend/.env` has `VITE_API_BASE_URL=http://localhost:7071/api`
3. Frontend dev server was restarted after changing `.env`

### CORS errors

Check that:
1. API `local.settings.json` has CORS configuration
2. API `Program.cs` has CORS policy for your frontend URL
3. Both services are running

### TypeScript errors in frontend

Run:
```bash
cd frontend
npm run build
```

This will show any TypeScript compilation errors.

## Production Deployment

This application is designed to be deployed to **Azure Static Web Apps**. See the root `README.md` for deployment instructions (to be added).

## License

MIT
