name: Copilot Workspace Setup

on:
  workflow_dispatch:
  push:
    branches:
      - 'copilot/**'

permissions:
  contents: read

jobs:
  setup:
    name: Setup Copilot Workspace Environment
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Install dependencies
        run: npm ci

      - name: Verify Playwright installation
        run: |
          npx playwright --version
          echo "Playwright installed successfully"

      - name: Setup environment files
        run: |
          if [ ! -f frontend/.env ]; then
            cp frontend/.env.example frontend/.env
            echo "Created frontend/.env from example"
          fi
          
          if [ ! -f api/local.settings.json ]; then
            cp api/local.settings.json.example api/local.settings.json
            echo "Created api/local.settings.json from example"
          fi

      - name: Setup complete
        run: |
          echo ":white_check_mark: Copilot Workspace setup complete!"
          echo ""
          echo ":clipboard: Next steps:"
          echo "  • Run 'npm run dev' to start the development servers"
          echo "  • Run 'npm test' to execute all Playwright tests"
          echo "  • Run 'npm run test:ui' for interactive test debugging"
          echo ""
          echo ":books: Documentation:"
          echo "  • docs/development.md - Development setup"
          echo "  • README.md - Quick reference"
